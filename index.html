<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ピックラボ・バトル</title>
  <style>
    :root{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
    body{margin:0;background:#f6f7fb;color:#1c2430}
    header{padding:14px 16px;border-bottom:1px solid #e5e8f0;display:flex;align-items:center;gap:12px;background:white;position:sticky;top:0;z-index:5}
    header h1{font-size:16px;margin:0}
    header .pill{font-size:12px;padding:4px 10px;border:1px solid #d8def0;border-radius:999px;color:#2b5cff;background:#f1f5ff}
    main{max-width:1100px;margin:0 auto;padding:16px;display:grid;gap:14px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{background:#ffffff;border:1px solid #e5e8f0;border-radius:14px;padding:14px;box-shadow:0 10px 25px rgba(17,24,39,.08)}
    .card h2{font-size:13px;margin:0 0 10px 0;color:#2b5cff;letter-spacing:.02em}
    .muted{color:#586579;font-size:12px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .btn{cursor:pointer;border:1px solid #d6dbea;background:#ffffff;color:#1c2430;border-radius:12px;padding:10px 12px;font-weight:700;text-decoration:none;display:inline-flex;align-items:center;justify-content:center}
    .btn:hover{filter:brightness(0.98);background:#f6f8ff}
    .btn:disabled{opacity:.50;cursor:not-allowed}
    .btnPrimary{border-color:#2b5cff;background:#2b5cff;color:white}
    .btnPrimary:hover{filter:brightness(0.98);background:#2452e8}
    .tag{display:inline-flex;align-items:center;gap:6px}
    .tag b{font-weight:800}
    .badge{font-size:11px;padding:2px 8px;border:1px solid #d8def0;border-radius:999px;color:#2b5cff;background:#f1f5ff}
    .hpbar{height:10px;background:#eef1f7;border-radius:999px;overflow:hidden}
    .hpbar>div{height:100%;background:#2b5cff}
    .monLine{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .monName{font-weight:900}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .log{height:260px;overflow:auto;background:#f7f9ff;border:1px solid #e5e8f0;border-radius:12px;padding:10px;font-size:12px;line-height:1.45}
    .sep{height:1px;background:#e5e8f0;margin:10px 0}
    .builderMon{border:1px solid #e5e8f0;border-radius:12px;padding:10px;background:#fbfcff}
    select, input[type="radio"], input[type="number"]{accent-color:#2b5cff}
    select{width:100%;padding:8px;border-radius:10px;border:1px solid #d6dbea;background:white;color:#1c2430}
    input[type="number"], input[type="text"]{width:100%;padding:8px;border-radius:10px;border:1px solid #d6dbea;background:white;color:#1c2430}
    label{font-size:12px;color:#2b5cff;font-weight:700}
    .small{font-size:11px}
    .right{display:flex;gap:8px;align-items:center}
    .k{color:#6b778c}
    .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .hidden{display:none !important}
    .imgRow{display:flex;gap:10px;align-items:center}
    .monImg{width:48px;height:48px;border-radius:12px;border:1px solid #e5e8f0;background:white;flex:0 0 auto}
    .fxFlash{animation:fxflash .35s ease-out 1}
    @keyframes fxflash{
      0%{transform:translateY(0);box-shadow:0 0 0 rgba(0,0,0,0)}
      35%{transform:translateY(-1px);box-shadow:0 0 0 6px rgba(43,92,255,.18)}
      100%{transform:translateY(0);box-shadow:0 0 0 rgba(0,0,0,0)}
    }
  
    /* --- UX tweaks: move select readability --- */
    select{font-size:16px;font-weight:800;line-height:1.2}
    select{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .moveSelInfo{margin-top:6px;font-size:12px;color:#1c2430;line-height:1.35}
    .moveSelInfo .meta{color:#586579;font-weight:700}
    .moveSelBlock{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width: 520px){
      .moveSelBlock{grid-template-columns:1fr}
    }


    @media (max-width: 820px){
      .grid3{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width: 520px){
      .grid3{grid-template-columns:1fr}
    }


    /* --- Compact setup: details/summary --- */
    details{border:1px solid #e5e8f0;border-radius:14px;padding:10px 12px;background:#fff}
    details + details{margin-top:10px}
    summary{cursor:pointer;font-weight:900;list-style:none}
    summary::-webkit-details-marker{display:none}
    summary:after{content:"▾";float:right;color:#586579}
    details[open] summary:after{content:"▴"}

    /* --- Prevent vertical "1文字ずつ折り返し" --- */
    .builderMon{min-width:0}
    .imgRow > div{min-width:0}
    .monLine > div:first-child{flex:1;min-width:0}
    .monName{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .muted.small{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    /* move info: 1行にして高さを削る */
    .moveSelInfo{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:11px}
</style>
</head>
<body>
<header>
  <h1>ピックラボ <span class="pill">対戦・選出シミュレーター</span></h1>
  <div class="muted">3vs3 / 見せ合い無し / 交代はターン消費 / 状態異常なし / OHKO(命中30%)</div>
</header>

<main>
  <section id="setup" class="card">
    <div class="flex" style="justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <h2 style="margin:0">バトル準備</h2>
        <div class="muted small">3体 → 4わざ → 先発</div>
      </div>
      <a class="btn" href="./info.html" target="_blank" rel="noopener">図鑑・わざ一覧</a>
    </div>

    <div class="sep"></div>

    <details id="step1" open>
      <summary>1) 手持ち（3体えらぶ）</summary>
      <div class="sep"></div>
      <div id="roster" class="grid3"></div>
    </details>

    <details id="step2">
      <summary>2) わざセット（各体4つ）</summary>
      <div class="sep"></div>
      <div id="movesets" class="grid3"></div>
    </details>

    <details id="step3">
      <summary>3) 先発 → 対戦開始</summary>
      <div class="sep"></div>
      <div id="leadPick" class="builderMon"></div>
      <div class="sep"></div>
      <div class="flex">
        <button id="btnStart" class="btn btnPrimary" disabled>対戦開始</button>
        <button id="btnRandom" class="btn">ランダムで選ぶ</button>
        <span class="muted small">※PvPはこのMVPでは未対応（後でサーバー化）</span>
      </div>
    </details>

    <details id="stepLog">
      <summary>ログ（表示用）</summary>
      <div class="sep"></div>
      <div id="log" class="log mono"></div>
    </details>
  </section>

  <section id="battle" class="hidden">
    <div class="row">
      <div class="card">
        <h2>相手（CPU）</h2>
        <div id="oppPanel"></div>
      </div>
      <div class="card">
        <h2>自分</h2>
        <div id="mePanel"></div>
      </div>
    </div>

    <div class="card">
      <h2>コマンド</h2>
      <div id="cmdPanel"></div>
      <div class="sep"></div>
      <div class="flex">
        <button id="btnNew" class="btn">最初から</button>
        <button id="btnExportLog" class="btn">管理者ログを書き出し（JSON）</button>
        <span class="muted small">※相手の控え・履歴は画面にも出しません</span>
      </div>
    </div>

    <div class="card">
      <h2>ログ（表示用）</h2>
      <div id="log" class="log mono"></div>
    </div>
  </section>

</main>

<script src="./app.js" defer></script>
</body>
</html>
